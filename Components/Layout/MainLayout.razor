@using MudBlazor
@using System.Linq
@using System.Runtime.CompilerServices
@using CapstoneBlazorApp.Services.Abstractions
@using CapstoneBlazorApp.Services
@using CapstoneBlazorApp.Components.Layout
@inherits LayoutComponentBase
@inject AbstractLoggerService LoggerService  
@inject NavigationManager Nav
@inject NavigationTracker NavigationTracker
@namespace CapstoneBlazorApp.Components.Layout

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme"/>
<MudDialogProvider />
<MudSnackbarProvider/>
<MudPopoverProvider /> 

<MudLayout>
    @if (!_isDebug) {
        <MudAppBar Color="Color.Primary" Elevation="0">
            <MudIconButton Color="Color.Inherit" OnClick="GoBack" Icon="@Icons.Material.Filled.ArrowBack"/>
            <MudText Typo="Typo.h6" Class="ml-3">CapstoneMaui</MudText>
            <MudSpacer />
            <MudIconButton Color="Color.Inherit" Icon="@Icons.Material.Filled.DarkMode" OnClick="ToggleDarkMode" />
        </MudAppBar>
    }   

    <MudMainContent Style="height: 100vh; overflow: hidden;">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    private bool _isDarkMode = false;
    private bool _isDebug = false; // Set to false to show the app bar
    
    private readonly MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight
        {
            Primary = "#1976D2",
            Secondary = "#303F9F",
            Background = "#FAFAFA",
            Surface = "#FFFFFF",
            AppbarBackground = "#1976D2",
            TextPrimary = "#212121",
            TextSecondary = "#757575"
        },
        PaletteDark = new PaletteDark
        {
            Primary = "#BB86FC",
            Secondary = "#03DAC6",
            Background = "#121212",
            Surface = "#1E1E1E",
            AppbarBackground = "#1E1E1E",
            TextPrimary = "#FFFFFF",
            TextSecondary = "#ECEFF1"
        }
    };

    protected override async Task OnInitializedAsync() {
        LoggerService.Log(this, "MainLayout initialized", "info");
        await base.OnInitializedAsync();
    }

    private void GoBack() {
        if(NavigationTracker.Count == 0) {
            Nav.NavigateTo("/");
            return;
        }
        Nav.NavigateTo(NavigationTracker.Pop());
    }
    
    private void ToggleDarkMode()
    {
        _isDarkMode = !_isDarkMode;
        StateHasChanged();
    }
}
